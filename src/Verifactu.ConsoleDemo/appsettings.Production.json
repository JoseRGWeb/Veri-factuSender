{
  "Logging": {
    "LogLevel": {
      "Default": "Warning",
      "Microsoft": "Warning",
      "Microsoft.Hosting.Lifetime": "Information",
      "Verifactu": "Information",
      "System.Net.Http.HttpClient": "Warning"
    },
    "Console": {
      "FormatterName": "json",
      "FormatterOptions": {
        "SingleLine": true,
        "TimestampFormat": "yyyy-MM-dd HH:mm:ss ",
        "UseUtcTimestamp": true
      }
    },
    "File": {
      "Comment": "Configuración de logging a archivo. Requiere paquete como Serilog.Sinks.File",
      "Path": "/var/log/verifactu/app-.log",
      "FileSizeLimitBytes": 52428800,
      "RetainedFileCountLimit": 30,
      "RollingInterval": "Day"
    }
  },
  "Certificado": {
    "Comment": "IMPORTANTE: NO almacenar credenciales en este archivo en producción",
    "Comment_PfxPath": "Usar gestor de secretos (Azure Key Vault, AWS Secrets Manager, etc.) o variables de entorno",
    "PfxPath": "",
    "PfxPassword": "",
    "Comment_Alternative": "Alternativamente, usar certificado del almacén del sistema",
    "StoreLocation": "CurrentUser",
    "StoreName": "My",
    "Thumbprint": "",
    "Comment_Thumbprint": "Huella digital (thumbprint) del certificado si se usa almacén del sistema"
  },
  "Verifactu": {
    "Environment": "Production",
    "Comment_Environment": "Entorno: Production (producción real con validez tributaria)",
    
    "Comment_EndpointUrl": "URL del endpoint de producción de AEAT. VERIFICAR con WSDL oficial más reciente",
    "EndpointUrl": "https://www1.aeat.es/wlpl/TIKE-CONT/SistemaFacturacion",
    
    "Comment_WsdlUrl": "URL del WSDL de producción (requiere certificado válido para descarga)",
    "WsdlUrl": "https://www2.agenciatributaria.gob.es/static_files/common/internet/dep/aplicaciones/es/aeat/burt/jdit/ws/SistemaFacturacion.wsdl",
    
    "Comment_SoapAction": "Acción SOAP para la operación. Valores: RegFacturacionAlta, RegFacturacionAnulacion, ConsultaRegistros, ValidarQR",
    "SoapAction": "RegFacturacionAlta",
    
    "Comment_Timeout": "Timeout en segundos para las peticiones SOAP (30 segundos recomendado para producción)",
    "Timeout": 30,
    
    "Comment_MaxRetries": "Número máximo de reintentos en caso de error temporal (recomendado: 3)",
    "MaxRetries": 3,
    
    "Comment_RetryDelayMs": "Delay inicial en milisegundos entre reintentos (se recomienda backoff exponencial)",
    "RetryDelayMs": 2000,
    
    "Comment_HuellaAnterior": "Huella SHA-256 del último registro enviado (para encadenamiento). Se actualiza automáticamente tras cada envío",
    "HuellaAnterior": "",
    
    "Comment_ValidarXmlContraXsd": "OBLIGATORIO en producción: validar XML contra XSD antes de enviar",
    "ValidarXmlContraXsd": true,
    
    "Comment_XsdBasePath": "Ruta base donde se encuentran los archivos XSD oficiales descargados de AEAT",
    "XsdBasePath": "./xsd",
    
    "Comment_RateLimiting": "Configuración de rate limiting para respetar límites de AEAT",
    "RateLimiting": {
      "MaxRequestsPerMinute": 60,
      "MaxRequestsPerHour": 1000,
      "EnableRateLimiting": true
    }
  },
  "Features": {
    "Comment_EnableDetailedErrors": "DESACTIVAR en producción para no exponer información sensible",
    "EnableDetailedErrors": false,
    
    "Comment_EnableRequestLogging": "DESACTIVAR o filtrar en producción para no registrar datos sensibles completos",
    "EnableRequestLogging": false,
    
    "Comment_EnableResponseLogging": "DESACTIVAR o filtrar en producción",
    "EnableResponseLogging": false,
    
    "Comment_ValidateBeforeSend": "OBLIGATORIO en producción: ejecutar todas las validaciones antes de enviar",
    "ValidateBeforeSend": true,
    
    "Comment_SaveGeneratedXml": "Solo activar si es necesario para auditoría, con permisos restrictivos",
    "SaveGeneratedXml": false,
    
    "Comment_XmlOutputPath": "Ruta segura donde guardar XML generados (solo si SaveGeneratedXml=true)",
    "XmlOutputPath": "/var/verifactu/xml",
    
    "Comment_EnableAuditLog": "Habilitar registro de auditoría completo para cumplimiento normativo",
    "EnableAuditLog": true,
    
    "Comment_AuditLogPath": "Ruta para logs de auditoría (conservar mínimo 4 años según normativa fiscal)",
    "AuditLogPath": "/var/verifactu/audit"
  },
  "Database": {
    "Comment": "Configuración de base de datos para persistencia de registros",
    "Comment_ConnectionString": "Usar gestor de secretos para connection string en producción",
    "ConnectionString": "",
    "Comment_Provider": "Proveedor: SqlServer, PostgreSQL, MySQL, MongoDB, etc.",
    "Provider": "SqlServer",
    "Comment_EnableRetention": "Habilitar política de retención (mínimo 4 años para facturas)",
    "EnableRetention": true,
    "RetentionYears": 6,
    "Comment_EnableBackup": "Configurar backups automáticos",
    "EnableBackup": true,
    "BackupSchedule": "Daily"
  },
  "Monitoring": {
    "Comment": "Configuración de monitorización y alertas",
    "Comment_EnableMetrics": "Habilitar recolección de métricas (Prometheus, Application Insights, etc.)",
    "EnableMetrics": true,
    
    "Comment_EnableHealthChecks": "Habilitar health checks para monitorización de disponibilidad",
    "EnableHealthChecks": true,
    "HealthCheckEndpoint": "/health",
    
    "Comment_AlertingEnabled": "Habilitar sistema de alertas",
    "AlertingEnabled": true,
    
    "Alerts": {
      "Comment_CriticalErrors": "Alertas para errores críticos",
      "CriticalErrorThreshold": 5,
      "CriticalErrorWindowMinutes": 15,
      
      "Comment_HighErrorRate": "Alertas si tasa de error supera umbral",
      "ErrorRateThreshold": 0.05,
      "ErrorRateWindowMinutes": 30,
      
      "Comment_CertificateExpiry": "Alertas de certificado próximo a caducar",
      "CertificateExpiryWarningDays": 60,
      "CertificateExpiryErrorDays": 30,
      
      "Comment_ServiceAvailability": "Alertas de disponibilidad del servicio AEAT",
      "ServiceUnavailableThresholdMinutes": 15
    },
    
    "Notifications": {
      "Comment_Email": "Configuración de notificaciones por email",
      "EmailEnabled": true,
      "EmailRecipients": [],
      "Comment_EmailRecipients": "Lista de emails del equipo técnico",
      
      "Comment_Sms": "Configuración de notificaciones SMS para alertas críticas (opcional)",
      "SmsEnabled": false,
      "SmsRecipients": [],
      
      "Comment_Webhook": "Webhook para integración con Slack, Teams, sistema de tickets, etc.",
      "WebhookEnabled": false,
      "WebhookUrl": ""
    }
  },
  "Security": {
    "Comment": "Configuración de seguridad adicional",
    
    "Comment_EnableDataEncryption": "Encriptar datos sensibles en reposo",
    "EnableDataEncryption": true,
    
    "Comment_EnableAuditTrail": "Registro completo de auditoría de accesos y operaciones",
    "EnableAuditTrail": true,
    
    "Comment_AllowedOrigins": "Orígenes permitidos si se expone como API (CORS)",
    "AllowedOrigins": [],
    
    "Comment_RequireHttps": "Requerir HTTPS para todas las comunicaciones",
    "RequireHttps": true,
    
    "Comment_CertificateValidation": "Validación estricta de certificados",
    "ValidateServerCertificate": true,
    "ValidateCertificateRevocation": true,
    
    "Comment_IpWhitelist": "Lista blanca de IPs permitidas (opcional, para mayor seguridad)",
    "EnableIpWhitelist": false,
    "AllowedIpAddresses": []
  },
  "Performance": {
    "Comment": "Configuración de rendimiento y optimización",
    
    "Comment_EnableCaching": "Habilitar caché para mejorar rendimiento (ej: validaciones XSD)",
    "EnableCaching": true,
    "CacheDurationMinutes": 60,
    
    "Comment_MaxConcurrentRequests": "Número máximo de peticiones concurrentes a AEAT",
    "MaxConcurrentRequests": 10,
    
    "Comment_ConnectionPooling": "Habilitar pooling de conexiones HTTP",
    "EnableConnectionPooling": true,
    "MaxConnectionsPerEndpoint": 10,
    
    "Comment_EnableCompression": "Habilitar compresión de peticiones/respuestas si AEAT lo soporta",
    "EnableCompression": false
  },
  "Resilience": {
    "Comment": "Configuración de resiliencia y manejo de fallos",
    
    "Comment_CircuitBreaker": "Circuit breaker para proteger contra fallos en cascada",
    "EnableCircuitBreaker": true,
    "CircuitBreakerThreshold": 5,
    "CircuitBreakerDurationSeconds": 60,
    
    "Comment_RetryQueue": "Cola de reintentos para registros fallidos",
    "EnableRetryQueue": true,
    "RetryQueueMaxSize": 10000,
    
    "Comment_DeadLetterQueue": "Cola de registros con fallos permanentes para procesamiento manual",
    "EnableDeadLetterQueue": true,
    
    "Comment_GracefulShutdown": "Shutdown graceful para completar operaciones en curso",
    "EnableGracefulShutdown": true,
    "ShutdownTimeoutSeconds": 30
  },
  "Compliance": {
    "Comment": "Configuración para cumplimiento normativo",
    
    "Comment_RGPD": "Cumplimiento RGPD - Protección de datos personales",
    "EnableDataAnonymization": true,
    "EnableRightToErasure": true,
    "DataRetentionYears": 6,
    
    "Comment_Fiscal": "Cumplimiento normativa fiscal española",
    "MinimumRetentionYears": 4,
    "EnableTaxAuditTrail": true,
    
    "Comment_SIF": "Cumplimiento específico de normativa SIF/VERI*FACTU",
    "SifCompliance": {
      "ValidateAllFields": true,
      "EnforceStrictValidation": true,
      "RequireDigitalSignature": true,
      "RequireChainOfCustody": true
    }
  },
  "Production": {
    "Comment": "Configuración específica del entorno de producción",
    
    "Comment_EnvironmentName": "Nombre del entorno (para identificación en logs y métricas)",
    "EnvironmentName": "Production",
    
    "Comment_DeploymentSlot": "Slot de despliegue (para blue-green deployments)",
    "DeploymentSlot": "primary",
    
    "Comment_MaintenanceWindow": "Ventana de mantenimiento programado",
    "MaintenanceWindow": {
      "Enabled": false,
      "DayOfWeek": "Sunday",
      "StartHour": 2,
      "DurationHours": 4
    },
    
    "Comment_EmergencyContacts": "Contactos de emergencia",
    "EmergencyContacts": {
      "TechnicalLead": "",
      "SystemAdmin": "",
      "SecurityOfficer": "",
      "AeatSupport": ""
    }
  }
}
